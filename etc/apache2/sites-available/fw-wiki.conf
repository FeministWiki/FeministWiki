<VirtualHost *:443>

	ServerName feministwiki.org
	ServerAlias feministwiki.dev

	ServerAlias fem.wiki
	ServerAlias feminism.wiki
	ServerAlias feminist.wiki
	ServerAlias www.feministwiki.org
	ServerAlias www.fem.wiki
	ServerAlias www.feminism.wiki
	ServerAlias www.feminist.wiki

	ServerAlias feministwiki.de
	ServerAlias www.feministwiki.de

	DocumentRoot /var/www/fw/wiki

	ErrorLog ${APACHE_LOG_DIR}/wiki-error.log
	CustomLog ${APACHE_LOG_DIR}/wiki-access.log combined

	Include /etc/apache2/include/ssl-common.conf
	Include /etc/apache2/include/ssl-fw.conf

	Include /etc/apache2/include/brotli.conf
	Include /etc/apache2/include/expires.conf
	Include /etc/apache2/include/unsafe-csp.conf
	Include /etc/apache2/include/default-fp.conf
	Include /etc/apache2/include/letsencrypt.conf

	<Location ~ "/\.well-known/host-meta(\.json)?">
		Header set Access-Control-Allow-Origin "*"
	</Location>

	RewriteEngine On

	RewriteCond "%{HTTP_HOST}" "^(www\.)?feministwiki\.de$"
	RewriteRule ^/*(wiki(/.*)?)?$ https://feministwiki.org/de%{REQUEST_URI} [L]

	RewriteCond "%{HTTP_HOST}" "!^feministwiki\.org$"
	RewriteCond "%{HTTP_HOST}" "!^feministwiki\.dev$"
	RewriteRule ^ https://feministwiki.org%{REQUEST_URI} [L]

	RewriteRule ^/*$           %{DOCUMENT_ROOT}/w/index.php [L]
	RewriteRule ^/?wiki(/.*)?$ %{DOCUMENT_ROOT}/w/index.php [L]

	<Macro Wiki %LANG>
		RewriteRule ^/?%LANG/*$          %{DOCUMENT_ROOT}/w/index.php [L]
		RewriteRule ^/?%LANG/wiki(/.*)?$ %{DOCUMENT_ROOT}/w/index.php [L]
		RewriteRule ^/?%LANG/w/(.*)$     %{DOCUMENT_ROOT}/w/$1 [L]
	</Macro>

	Use Wiki de
	Use Wiki es
	Use Wiki fr
	Use Wiki it
	Use Wiki pt

</VirtualHost>
